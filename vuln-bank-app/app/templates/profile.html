{% extends "base.html" %}

{% block title %}User Profile - {{ user.username }}{% endblock %}

{% block content %}
    
    <div class="container">
        <h2>User Profile</h2>
        
        <div class="profile-card">
            <h3>{{ user.username }}</h3>
            <p><strong>Email:</strong> {{ user.email }}</p>
            {# Asumiendo que pasaste un objeto 'user' completo (que contiene 'balance') #}
            <p><strong>Balance:</strong> ${{ "%.2f"|format(user.balance) }}</p>
            
            <div class="sensitive-data">
                <h4>⚠️ Sensitive Information (IDOR Test):</h4>
                {# La exposición de datos sensibles está intencionalmente aquí para la prueba #}
                <p><strong>SSN:</strong> {{ user.ssn }}</p>
                <p><strong>Account ID:</strong> {{ user.id }}</p>
                <p><strong>Admin:</strong> {{ user.is_admin }}</p>
            </div>
            
            <div class="vulnerable-form">
                <h4>Profile Template Editor (SSTI Test)</h4>
                {# Nota: Este formulario requerirá una ruta en app.py: /render_template #}
                <form action="/render_template" method="POST">
                    <textarea name="template" rows="5" style="width:100%">
Hello {{ user.username }},
Your SSN is: {{ user.ssn }}
Your balance is: {{ user.balance }}
                    </textarea>
                    <button type="submit">Render Template</button>
                </form>
                <p><small>This feature is for customizing profile views. Try {{ 7*7 }}</small></p>
            </div>
            
            <div class="vulnerable-form">
                <h4>Load Custom Profile (Insecure Deserialization Test)</h4>
                {# Nota: Este formulario requerirá una ruta en app.py: /profile/load #}
                <form action="/import_profile" method="POST">
                    <input type="text" name="data" 
                           placeholder="Enter Base64-encoded pickle data" 
                           style="width:100%; padding:0.5rem;">
                    <button type="submit">Load Profile</button>
                </form>
                <p><small>Example: Import Profile using base64-encoded pickle payload.</small></p>
            </div>
        </div>
        
        <div class="profile-actions">
            <h4>Account Tools:</h4>
            <ul>
                <li><a href="/search?q={{ user.username }}">Search similar users (SQLi)</a></li>
                <li><a href="/download?file=profile.html">View template source (LFI)</a></li>
                <li><a href="/ping?host=echo {{ user.username }}">Test command (CMDi)</a></li>
                {# SSRF: Asumiendo que 'fetch_url' es la ruta '/fetch' #}
                <li><a href="/fetch?url=http://internal.bank.local/users/{{ user.id }}">Fetch internal data (SSRF)</a></li>
            </ul>
        </div>
        
        <div class="debug-info">
            <h5>Debug Information (For testing purposes):</h5>
            <p>User ID: {{ user.id }}</p>
            <p>Session ID: {{ session.get('user_id', 'None') }}</p>
            <p>Template: profile.html</p>
        </div>
    </div>
{% endblock %}
