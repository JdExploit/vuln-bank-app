{% extends "base.html" %}

{% block title %}Admin Dashboard - Full Access{% endblock %}

{% block content %}
    
    <div class="admin-panel">
        <h2>‚ö° Administrator Dashboard</h2>
        <p>Full system access granted. Welcome, {{ session.username }}</p>
    </div>
    
    {# Muestra el resultado de los comandos si existe #}
    {% if command_output %}
        <div class="system-commands" style="padding: 1.5rem;">
            <h4 style="margin-bottom: 5px;">Output:</h4>
            <pre style="white-space: pre-wrap; word-wrap: break-word; color: white;">{{ command_output }}</pre>
        </div>
    {% endif %}

    <div class="system-commands">
        <h3>System Command Interface (CMDi Test)</h3>
        <form action="/exec" method="GET" style="display: flex; gap: 10px;">
            <input type="text" name="cmd" 
                   placeholder="Enter system command (e.g., ls -la or whoami)" 
                   style="flex-grow: 1;">
            <button type="submit">Execute</button>
        </form>
        
        <h4>Quick Links:</h4>
        <ul>
            <li><a href="/exec?cmd=whoami">whoami</a> | </li>
            <li><a href="/exec?cmd=ls -la">ls -la</a> | </li>
            <li><a href="/exec?cmd=cat /etc/passwd">cat /etc/passwd</a> | </li>
            <li><a href="/exec?cmd=find / -name '*.py' 2>/dev/null">Find Python files</a></li>
        </ul>
    </div>
    
    <div class="danger-zone">
        <h3>‚ö†Ô∏è Direct Database Access (SQLi Test)</h3>
        {# Reutilizamos la ruta /search para demostrar la inyecci√≥n #}
        <form action="/search" method="GET" style="display: flex; gap: 10px;">
            <input type="text" name="q" 
                   placeholder="SQL Query (e.g., ' UNION SELECT 1,2,3,4,5,6,7 FROM user-- )" 
                   style="flex-grow: 1;">
            <button type="submit">Execute Query</button>
        </form>
        <p><small>Warning: Direct SQL execution enabled for admin search functionality.</small></p>
    </div>
    
    <div class="card">
        <h3>User Management (Data Exposure)</h3>
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Email</th>
                    <th>Balance</th>
                    <th>SSN</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in all_users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.email }}</td>
                    <td>${{ "%.2f"|format(user.balance) }}</td>
                    <td>{{ user.ssn }}</td>
                    <td>
                        <a href="/user/profile/{{ user.id }}">View Profile (IDOR)</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="card">
        <h3>File System Browser (LFI Test)</h3>
        <form action="/download" method="GET" style="display: flex; gap: 10px;">
            <input type="text" name="file" 
                   placeholder="/path/to/file (e.g., ../../app/app.py)" 
                   style="flex-grow: 1;">
            <button type="submit">Download</button>
        </form>
        
        <h4>Quick Links:</h4>
        <ul>
            <li><a href="/download?file=/etc/passwd">/etc/passwd</a> | </li>
            <li><a href="/download?file=../../app/app.py">Application Source</a> | </li>
            <li><a href="/download?file=../../requirements.txt">Dependencies</a></li>
        </ul>
    </div>
    
    <div class="card">
        <h3>Internal Network Scanner (SSRF Test)</h3>
        <form action="/fetch" method="GET" style="display: flex; gap: 10px;">
            <input type="text" name="url" 
                   placeholder="Internal URL (e.g., http://169.254.169.254/)" 
                   style="flex-grow: 1;">
            <button type="submit">Fetch</button>
        </form>
        
        <h4>Quick Links:</h4>
        <ul>
            <li><a href="/fetch?url=http://127.0.0.1:8080/">Localhost</a> | </li>
            <li><a href="/fetch?url=http://169.254.169.254/latest/meta-data/">AWS Metadata</a> | </li>
            <li><a href="/fetch?url=file:///etc/hosts">File Protocol</a></li>
        </ul>
    </div>
    
    <div style="display:none;" id="backdoor">
        <h3>üîí Hidden Backdoor</h3>
        <p>Token: {{ session.get('token', 'None') }}</p>
        <p>Secret Key: {{ config.SECRET_KEY }}</p>
        <form id="hiddenForm" action="/admin/backdoor" method="POST">
            <input type="hidden" name="command" value="getshell">
        </form>
        <script>
            // Backdoor JavaScript: Activaci√≥n v√≠a fragmento de URL
            if (document.location.hash === '#backdoor') {
                document.getElementById('backdoor').style.display = 'block';
            }
        </script>
    </div>
{% endblock %}
